<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src *" />
    <script src="js/jquery.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/index.js" type="text/javascript"></script>
    <script src="js/simplej.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/fixed-navigation-bar.css">
    <title>Gian hàng online</title>
    <script type="text/javascript">

      $(document).ready(function()
      {
      var root = baseurl;
      var url=root+"showdata2.php";
      var urlIMG = root+"data/img/";
      var urlAvatar = urlIMG+"avatar/";
      $.getJSON(url,function(result){
        console.log(result);
        $.each(result, function(i, field){
        var user = localStorage.iduser;
        var id=field.id;
        var iduser=field.iduser;
        var img=field.img;
        var noidung=field.noidung;
        var avatar=field.avatar;
        var hoten=field.hoten;
        var Time=field.Time;
        var LoveIcon="";
        $("#white"+id).hide();
        $("#yellow"+id).hide();
        $("#p_green"+id).hide();
        $("#p_yellow"+id).hide();
        //$("#dv_sanpham").append('<div class="dv_r_sanpham" id="dv_r_sanpham"> <center><img src="'+urlIMG+img+'" class="center-cropped" data-toggle="modal" id="popupbv'+id+'" data-target="#myModal'+id+'" /><span style="position: absolute;left:0;top:0;font-size:12px;color:rgb(97, 97, 97);padding:5px;text-align:left">'+noidung+'</span></center> <div class="socials"> <div style="width:33%;float:left"> <img src="img/whitelove.png" style="width:23%;height:10%" id="white'+id+'" /><img src="img/yellowlove.png" style="width:23%;height:10%" id="yellow'+id+'" /><span style="text-align:center;font-size:9px;color:#fff;margin:0px 0px 10px 2px"  id="soluotlike'+id+'" data-toggle="modal" data-target="#show_userlike'+id+'"></span><input type="hidden" id="value'+id+'" value="'+id+'"/><!--Show người like--><div style="margin-top:52px" class="modal fade" id="show_userlike'+id+'" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> <div class="modal-dialog"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h4 class="modal-title" id="myModalLabel"><span style="color:blue" id="solike'+id+'"></span>người đã thích</h4> </div> <div class="modal-body" id="modal-body'+id+'"> </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button> </div> </div> </div></div><!--end show người like--> </div> <div style="width:33%;float:left"> <img src="img/comment.png" style="width:23%;height:30%" /> </div> <div style="width:33%;float:left"> <img src="img/share.png" style="width:23%;height:30%" /> </div> </div><div class="modal fade" style="margin-top: 52px;" id="myModal'+id+'" role="dialog"> <div class="modal-dialog"> <!-- Modal content--> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> <h4 class="modal-title">'+noidung+'</h4> </div> <div class="modal-body"><center> <img src="'+urlIMG+img+'" class="img-responsive" /></center></div> <div class="modal-footer" style="text-align: :left;">       <div style="width:100%;"><div style="width:7%;float:left;margin:0px 20px 10px 5px"><img src="img/love_nf_green.png" class="img-responsive" id="p_green'+id+'" /><img src="img/love_nf_yellow.png" id="p_yellow'+id+'" class="img-responsive" /></div><div style="width:7%;float:left;margin:0px 20px 10px 5px"><img src="img/comment_nf.png" class="img-responsive" /></div><div style="width:7%;float:left;margin:0px 20px 10px 5px"><img src="img/share_nf.png" class="img-responsive" /></div></div>     <hr style="clear:both"/><div class="comment_p"><!-- Area từng comment --><div id="binhluan'+id+'" style="margin-left:10px;margin-top:-5px"> </div><!-- End Area từng comment --><!-- Area Comment --><table cellpadding="0" cellspacing="0" style="width:100%"> <tr> <td> <div align="left"> <form method="post" name="form" action=""> <table cellpadding="0" cellspacing="0" style="width:100%"> <tr> <td align="left"> </td> </tr> <tr> <td style="padding:4px; padding-left:10px;" class="comment_box"> <input type="hidden" name="idbv" id="idbv'+id+'" value="'+id+'" /> <textarea cols="30" rows="2" placeholder="Nhập bình luận ..." name="content" id="content'+id+'" maxlength="145" class="form-control"></textarea> <input type="submit" value="Trả lời" id="v'+id+'" name="submit" class="form-control comment_button'+id+'" style="width:30%;float:right;margin-top:5px" /> </td> </tr> </table> </form> </div> <div style="height:7px"></div> <div id="flash" align="left"></div> <div id="display" align="left"></div> </td> </tr></table><!-- End Area Comment--></div> </div> </div> </div> </div> ');
        //$("#sanpham2").append('<div class="col-xs-4 col-sm-5cols" id="sanphamcon_'+id+'"> <div class="thumbnail"> <img src="'+urlIMG+img+'" class="portrait"> </div> </div>');
        $('#dv_sanpham').append('<div style="width:100%"> <div style="width:15%;float:left"> <div class="thumbnail" style="height:50px;border-radius: 40px;"> <img src="'+urlAvatar+avatar+'" class="portrait" /> </div> </div> <div style="width:80%;float:left;margin-left:10px"> <span style="font-size:12px;color:#000;font-weight:bold;padding-left:5px">'+hoten+'</span><br /> <span style="font-size:10px;color:rgb(205, 205, 205);padding-left:5px">'+CachDay(Time)+'</span> </div> <div style="clear:both"></div> </div> <div style="margin-top:6px"> <center><img src="'+urlIMG+img+'" class="img-responsive" /></center><br/> <div style="width:100%"> <div style="width:10%;float:left;border-radius: 40px;background:rgb(221, 221, 221);padding:5px"> <img src="img/love_nf_green.png" class="img-responsive" /> </div> <div style="width:9.2%;float:left;border-radius: 40px;background:rgb(221, 221, 221);padding:5px;margin-left:10px"> <img src="img/comment_nf.png" class="img-responsive" /> </div> <div style="width:10%;float:left;border-radius: 40px;background:rgb(221, 221, 221);padding:5px;margin-left:10px"> <img src="img/share_nf.png" class="img-responsive" /> </div> <div style="clear:both"></div> </div> <span style="color:#000;font-size:12px">'+noidung+'</span> </div> <hr />');
        GotoArticle("article.html",id,"sanphamcon_"+id);
        //Check like chưa
        var dataString="username="+user+"&idbaiviet="+id+"&checklike=";
        $.ajax({
        type: "POST",
        url: baseurl + "checkliked.php",
        data: dataString,
        crossDomain: true,
        cache: false,
        success: function(data)
        {
            if(data=="yes")
            {
              $("#white"+id).show();
              $("#yellow"+id).hide();
              $("#p_green"+id).show();
              $("#p_yellow"+id).hide();
            }
            else
            {
              $("#white"+id).hide();
              $("#yellow"+id).show();
              $("#p_green"+id).hide();
              $("#p_yellow"+id).show();
            }
            //$("#test").html(data);
        }
        });
        //End check like
        //Xử lý đếm số like
        function demlike(id)
        {
          var dataString="idbaiviet="+id+"&demlike=";
          $.ajax({
          type: "POST",
          url: "http://gianhangonline.com.vn/service/show_like.php",
          data: dataString,
          crossDomain: true,
          cache: false,
          success: function(data)
          {
              localStorage.solike = data;
              $('#soluotlike'+id).html(data);
          }
          });
        }

        demlike(id);
        //Xử lý lưu like
        $("#white"+id).click(function() {
          var dataString="username="+user+"&idbaiviet="+id+"&user_noted=" + iduser + "&savelike=";
          $.ajax({
          type: "POST",
          url: "http://gianhangonline.com.vn/service/insert_like.php",
          data: dataString,
          crossDomain: true,
          cache: false,
          success: function(data)
          {
              if(data=="yes")
              {
                demlike(id);
                $("#white"+id).hide();
                $("#yellow"+id).show();
                $("#p_green"+id).hide();
                $("#p_yellow"+id).show();
              }
              else
              {
                demlike(id);
                $("#white"+id).show();
                $("#show"+id).hide();
                $("#p_green"+id).show();
                $("#p_yellow"+id).hide();
              }
              //$("#test").html(data);
          }
          });
        });
        $("#p_green"+id).click(function() {
          var dataString="username="+user+"&idbaiviet="+id+"&user_noted=" + iduser + "&savelike=";
          $.ajax({
          type: "POST",
          url: "http://gianhangonline.com.vn/service/insert_like.php",
          data: dataString,
          crossDomain: true,
          cache: false,
          success: function(data)
          {
              if(data=="yes")
              {
                demlike(id);
                $("#p_green"+id).hide();
                $("#p_yellow"+id).show();
                $("#white"+id).hide();
                $("#yellow"+id).show();
              }
              else
              {
                demlike(id);
                $("#p_green"+id).show();
                $("#p_yellow"+id).hide();
                $("#white"+id).show();
                $("#yellow"+id).hide();
              }
              //$("#test").html(data);
          }
          });
        });
        //End xử lý lưu like


        //End xử lý đếm số like

        //Xử lý show người like
        //Lấy số người like
        function demlike2(id)
        {
          var dataString="idbaiviet="+id+"&demlike=";
          $.ajax({
          type: "POST",
          url: "http://gianhangonline.com.vn/service/show_like.php",
          data: dataString,
          crossDomain: true,
          cache: false,
          success: function(data)
          {
              $('#value'+id).val(data);
          }
          });
        }
        demlike2(id);
        $('#soluotlike'+id).click(function() {
          $('#modal-body'+id).html("");
          var idbvv = $('#value'+id).val();
          var url=root+"show_userlike.php?idbv="+id;
          var soluotlike=$('#value'+id).val();
          $.getJSON(url,function(reslike){
            console.log(reslike);
            $.each(reslike, function(k, rowlike){
            var username_like=rowlike.username;
            var hoten_like=rowlike.hoten;
            var avatar_like=rowlike.avatar;
            var time_like=rowlike.Time;

            var urlAvatar = urlIMG+"avatar/";
            $('#solike'+id).html(soluotlike+" ");
            $('#modal-body'+id).append('<div style="width:10%;float:left"><img src="'+urlAvatar+avatar_like+'" class="img-responsive"> </div> <div style="width:80%;float:left;margin-left:10px" id="userlike_'+username_like+'">'+hoten_like+' </div> <div style="clear:both"> </div><hr />');
            $('#show_userlike'+id).modal('show');

            $("#userlike_"+username_like).click(function() {
              localStorage.username = username_like;
              window.location.href="user.html";
            });

          });
          });
        });

        //End xử lý show người like

        //Xử lý dislike
        $("#yellow"+id).click(function() {
          var dataString="username="+user+"&idbaiviet="+id+"&dislike=";
          $.ajax({
          type: "POST",
          url: "http://gianhangonline.com.vn/service/delete_like.php",
          data: dataString,
          crossDomain: true,
          cache: false,
          success: function(data)
          {
              if(data=="yes")
              {
                demlike(id);
                $("#white"+id).show();
                $("#yellow"+id).hide();
                $("#p_green"+id).show();
                $("#p_yellow"+id).hide();
              }
              else
              {
                demlike(id);
                $("#white"+id).hide();
                $("#yellow"+id).show();
                $("#p_green"+id).hide();
                $("#p_yellow"+id).show();
              }
              //$("#test").html(data);
          }
          });
        });
        $("#p_yellow"+id).click(function() {
          var dataString="username="+user+"&idbaiviet="+id+"&dislike=";
          $.ajax({
          type: "POST",
          url: "http://gianhangonline.com.vn/service/delete_like.php",
          data: dataString,
          crossDomain: true,
          cache: false,
          success: function(data)
          {
              if(data=="yes")
              {
                demlike(id);
                $("#p_green"+id).show();
                $("#p_yellow"+id).hide();
                $("#white"+id).show();
                $("#yellow"+id).hide();
              }
              else
              {
                demlike(id);
                $("#p_green"+id).hide();
                $("#p_yellow"+id).show();
                $("#white"+id).hide();
                $("#yellow"+id).show();
              }
              //$("#test").html(data);
          }
          });
        });
        //End xử lý lưu like

        //Load comment từng row
        $("#popupbv"+id).click(function() {
          $("#binhluan"+id).html("");
          var url=root+"show_comment.php?idbv="+id;
          var urlAvatar = urlIMG+"avatar/";
            $.getJSON(url,function(comment){
              console.log(comment);
              $.each(comment, function(j, row){
                var idcomment=row.id;
                var idbv=row.idbaiviet;
                var username=row.username;
                var hoten=row.hoten;
                var hinhanh=row.avatar;
                var noidung_comment=row.noidung;
                var Time_comment=row.Time;
                $("#binhluan"+id).append('<div class="col-md-12" style="text-align:left;background:#fff;padding: 10px;font-size:12px"> <div style="width:10%;float:left"> <img src="'+urlAvatar+hinhanh+'" class="img-responsive" /> </div> <div style="width:85%;float:left;padding-left:10px"> '+noidung_comment+' <br/> <span style="font-size:11px">Bởi</span> <span style="color:rgb(90, 81, 204);font-size:11px" id="idcomment'+idcomment+'">'+hoten+'</span> <span style="color:rgb(168, 37, 37);font-size:11px">'+CachDay(Time_comment)+'</span> </div> <div style="clear:both"></div></div>');

                $("#idcomment"+idcomment).click(function() {
                  localStorage.username = username;
                  window.location.href="user.html";
                });

              });
            });
        });

        //End load comment từng row
        //Xử lý insert comment
        $(function() {
            $(".comment_button"+id).click(function() {
                var element = $(this);
                var noidung = $("#content"+id).val();
                var idbv = $("#idbv"+id).val();
                var username = user;
                var dataString = 'content=' + noidung + '&idbv=' + idbv + '&username=' + username + "&user_noted=" + iduser + '&postcm=';
                if (noidung == '') {
                    alert("Bạn chưa nhập bình luận");
                } else {
                    $("#flash"+id).show();
                    $("#flash"+id).fadeIn(400).html('<img src="img/loading.gif" align="absmiddle" height="10" width="10" >&nbsp;<span class="loading">Loading Comment...</span>');
                    $.ajax({
                        type: "POST",
                        url: "http://gianhangonline.com.vn/service/insert_comment.php",
                        data: dataString,
                        cache: false,
                        success: function(html) {
                            //$("#display").append(html);
                            $("#content"+id).val('');
                            $("#flash"+id).hide();
                            $("#binhluan"+id).html(html);
                            //$("#test").html(html);
                        }
                    });
                }
                return false;
            });
        });

        });
      });
      });
      //Hàm di chuyển đến Trang nào đó
      GotoPage2_focus("timkiem.html","txtTim");
    </script>
</head>
<body>
  <nav class="fixed-nav-bar">
  <div class="navbar" style="height:20px;width:100%;background-color:#000">
    <table style="width:100%;height:100%">
      <tr>
        <td style="width:11%;padding-right:20px;padding-left:5px">
          <a href="category.html"><img src="img/cate.png" class="img-responsive" /></a>
        </td>
        <td style="width:10%;padding-right:20px">
          <a href="home.html">
            <img src="img/home.png" class="img-responsive"  />
          </a>
        </td>
        <td style="width:10%;padding-right:20px">
          <a href="follow.html"><img src="img/user.png" class="img-responsive"  /></a>
        </td>
        <td style="width:10%;padding-right:20px">
          <a href="chat.html"><img src="img/chat.png" class="img-responsive" /></a>
        </td>
        <td style="width:10%;padding-right:20px" id="chuong">
          <div style="position:relative">
            <img src="img/chuong.png" class="img-responsive"  />
            <div id="note">

            </div>
          </div>
        </td>
        <td style="width:40%;padding:7px;font-size:10px">
          <input type="text" class="form-control" id="txtTim" placeholder="Nhập tên sản phẩm ..." />
        </td>
      </tr>
    </table>
  </div>
</nav>
  <!-- Show sản phẩm -->
  <div class="dv_sanpham" id="dv_sanpham" style="margin-top:60px;padding:10px">
    <span id="test" style="color:#000"></span>



  </div>



<script type="text/javascript">
//Show số lượng thông báo
var username = localStorage.iduser;
ShowNote(username,"note","show_note.php");
//Hàm update note và chuyển đến trang chi tiết note
var page="note.html";
var control="chuong";
var action="update_note.php";
//Idea: Kiểm tra theo post localStorage.sonote nếu > 0 mới update
GotoNote(page,username,control,action);
</script>
<script src="cordova.js" type="text/javascript"></script>
</body>
</html>
